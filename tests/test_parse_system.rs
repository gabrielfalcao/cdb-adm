use cdb_adm::{parse_services, Result};
use iocore_test::folder_path;

fn load_test_file() -> String {
    let path = folder_path!().join("launchctl-print-system");
    path.read().expect(&format!("contents of {}", &path))
}
#[test]
fn test_parse_services() -> Result<()> {
    let services = parse_services(&load_test_file())?
        .iter()
        .map(|(_, _, service)| service.to_string())
        .collect::<Vec<String>>();

    assert_eq!(
        services,
        vec![
            "com.apple.loginwindow.3EA62163-2E22-44E8-B10B-8768A6312095",
            "com.apple.rpmuxd",
            "com.apple.lskdd",
            "com.apple.kernelmanager_helper",
            "com.apple.runningboardd",
            "com.apple.installcoordination_proxy",
            "com.apple.wifiFirmwareLoader",
            "com.apple.uninstalld",
            "com.apple.diagnosticextensions.osx.spotlight.helper",
            "com.apple.tzlinkd",
            "com.apple.tmp_cleaner",
            "com.apple.ReportSystemMemory",
            "com.apple.diagnosticextensions.osx.timemachine.helper",
            "com.apple.kcproxy",
            "com.apple.fseventsd",
            "com.apple.mobile.obliteration",
            "com.apple.security.cryptexd",
            "com.apple.devicemanagementclient.managedeventsd",
            "com.apple.CoreAuthentication.daemon",
            "com.apple.Kerberos.digest-service",
            "com.apple.systempreferences.cacheAssistant",
            "com.apple.XprotectFramework.PluginService",
            "com.apple.XProtect.daemon.scan",
            "com.apple.filesystems.fskitd",
            "com.apple.logd_helper",
            "com.apple.automountd",
            "com.apple.TrustEvaluationAgent.system",
            "com.apple.coreservicesd",
            "com.apple.newsyslog",
            "com.apple.mediaremoted",
            "com.apple.wifianalyticsd",
            "com.apple.adid",
            "com.apple.driverkit.AppleUserHIDDrivers-0x100000c2d",
            "homebrew.mxcl.dnsmasq",
            "com.apple.AmbientDisplayAgent",
            "com.apple.MRTd",
            "com.apple.modelcatalogd",
            "com.vix.cron",
            "com.apple.touchbarserver",
            "com.apple.mbusertrampoline",
            "com.apple.thermald",
            "com.apple.FileCoordination",
            "com.apple.deleted_helper",
            "com.apple.taskgated",
            "com.apple.GSSCred",
            "com.apple.audio.systemsoundserverd",
            "com.apple.RemoteDesktop.PrivilegeProxy",
            "com.apple.colorsync.displayservices",
            "com.apple.avbdeviced",
            "com.apple.XProtect.daemon.scan.startup",
            "com.apple.coreservices.appleevents",
            "com.apple.cvmsServ",
            "com.apple.systemstats.analysis",
            "com.apple.iomfb_fdr_loader",
            "com.apple.eapolcfg_auth",
            "com.apple.diskimagesiod",
            "com.apple.accessoryupdaterd",
            "com.apple.xpc.smd",
            "com.apple.diagnosticd",
            "com.apple.AssetCacheTetheratorService",
            "com.apple.gkreport",
            "com.apple.wifivelocityd",
            "com.apple.modelmanagerd",
            "com.apple.configd",
            "com.apple.mobilegestalt.xpc",
            "com.apple.installandsetup.systemmigrationd",
            "com.apple.applessdstatistics",
            "com.apple.BTServer.le",
            "com.apple.endpointsecurity.endpointsecurityd",
            "com.apple.captiveagent",
            "com.apple.sysdiagnose",
            "com.apple.corercd",
            "com.apple.colorsyncd",
            "com.apple.hdiejectd",
            "com.apple.backupd",
            "com.apple.metadata.mds.spindump",
            "com.apple.Kerberos.kpasswdd",
            "com.apple.installd",
            "com.apple.powerd",
            "com.apple.corestorage.corestoraged",
            "com.apple.system_installd",
            "com.apple.storagekitd",
            "com.apple.WirelessRadioManager",
            "com.apple.mobileassetd",
            "com.apple.audio.AudioComponentRegistrar",
            "com.apple.nand.aspcarry",
            "com.apple.srp-mdns-proxy",
            "com.apple.AccountPolicyHelper",
            "com.apple.DASDelegateService",
            "com.apple.AppStoreDaemon.StorePrivilegedODRService",
            "com.apple.authd",
            "com.apple.iomfb_bics_daemon",
            "com.apple.biomed",
            "com.apple.ospredictiond",
            "com.apple.InstallerDiagnostics.installerdiagwatcher",
            "com.apple.dvdplayback.setregion",
            "com.apple.eoshostd",
            "com.apple.PowerUIAgent",
            "com.apple.airport.wps",
            "com.apple.corekdld",
            "com.apple.audioanalyticsd",
            "com.apple.AssetCacheLocatorService",
            "com.apple.dt.automationmode-writer",
            "com.apple.UpdateSettings",
            "com.apple.filesystems.doubleagentd",
            "com.apple.fontmover",
            "com.apple.oahd-root-helper",
            "com.apple.MobileFileIntegrity",
            "com.apple.DumpPanic",
            "com.apple.msrpc.wkssvc",
            "com.apple.netauth.sys.auth",
            "com.apple.nehelper",
            "com.apple.remoted",
            "com.apple.ManagedClient.mechanism",
            "com.apple.oahd",
            "com.apple.UserNotificationCenter",
            "com.apple.boswatcher",
            "com.apple.trustdFileHelper",
            "com.apple.InstallerDiagnostics.installerdiagd",
            "com.apple.nfsconf",
            "com.apple.storereceiptinstaller",
            "com.apple.mobileactivationd",
            "com.apple.logd",
            "com.apple.mobile.keybagd",
            "com.apple.softwareupdated",
            "com.apple.systemadministration.writeconfig",
            "com.apple.vsdbutil",
            "com.apple.mobile.NRDUpdated",
            "com.apple.erasecontentsettingshelperd",
            "com.apple.tccd.system",
            "com.apple.diskmanagementstartup",
            "com.apple.seld",
            "com.apple.accessoryd",
            "com.apple.appleseed.fbahelperd",
            "com.apple.mobile.storage_mounter_proxy",
            "com.apple.airportd",
            "com.apple.memory-maintenance",
            "com.apple.aneuserd",
            "com.apple.configureLocalKDC",
            "com.apple.BlueTool",
            "com.apple.icloud.findmydeviced",
            "com.apple.audio.coreaudiod",
            "com.apple.akd",
            "com.apple.liquiddetectiond",
            "com.apple.mobile.softwareupdated",
            "com.apple.PerfPowerTelemetryClientRegistrationService",
            "com.apple.spindump",
            "com.apple.lockd",
            "com.apple.nfcd",
            "com.apple.signpost.signpost_reporter",
            "com.apple.postfix.master",
            "com.apple.IFCStart",
            "com.apple.gamepolicyd",
            "com.apple.watchdogd",
            "com.apple.warmd",
            "com.apple.usbaudiod",
            "com.apple.pfd",
            "com.apple.metadata.mds",
            "com.apple.SubmitDiagInfo",
            "com.apple.applekeystored",
            "com.apple.IOUserDockChannelSerial-0x100000c2b",
            "com.apple.MobileInstallationHelperService",
            "com.apple.powerd.swd",
            "com.apple.ManagedClient",
            "com.apple.cmio.VDCAssistant",
            "com.apple.iconservices.iconservicesd",
            "com.apple.AppleQEMUGuestAgent",
            "com.apple.ContainerMigrationService",
            "com.apple.iconservices.iconservicesagent",
            "com.apple.asr",
            "com.apple.testmanagerd.remote",
            "com.apple.xpc.uscwoap",
            "com.apple.kernelmanagerd",
            "com.apple.AppSSODaemon",
            "com.apple.diskarbitrationd",
            "com.apple.security.authtrampoline",
            "com.apple.DumpPanic.Accessory",
            "com.apple.rpcbind",
            "com.apple.printtool.daemon",
            "com.apple.securityd.system",
            "com.apple.audiomxd",
            "com.apple.cmio.uvcassistantextension",
            "com.apple.containermanagerd.system",
            "com.apple.InstallerProgress",
            "com.apple.RosettaUpdateService",
            "NetworkExtension.com.objective-see.lulu.extension.3.1.3.3.1.3",
            "com.apple.AXMediaUtilitiesService",
            "com.apple.nlcd",
            "com.apple.pfctl",
            "com.apple.security.authhost",
            "com.apple.mdmclient.daemon",
            "com.apple.dprivacyd",
            "com.apple.logkextloadsd",
            "com.apple.systemkeychain",
            "com.apple.coreduetd",
            "com.apple.backupd-helper",
            "com.apple.installcoordinationd",
            "com.apple.fairplayd",
            "com.apple.ctkd",
            "com.apple.bootinstalld",
            "com.apple.filesystems.userfsd",
            "com.apple.misagent",
            "com.apple.icloud.searchpartyd",
            "com.apple.security.agent.login",
            "com.apple.retimerd",
            "com.apple.syslogd",
            "com.apple.mbsystemadministration",
            "tcpdump",
            "com.apple.DesktopServicesHelper",
            "com.apple.symptomsd-diag",
            "com.apple.ecosystemanalyticsd",
            "com.apple.Virtualization.AppleVirtualPlatformHIDBridge",
            "com.apple.WindowServer",
            "com.apple.ucupdate.plist",
            "com.apple.netauth.sys.gui",
            "com.apple.sysdiagnose_helper",
            "com.apple.diskimagesiod.ram",
            "com.apple.cameracaptured",
            "com.apple.postfix.newaliases",
            "com.apple.xpc.roleaccountd",
            "com.apple.eligibilityd",
            "com.apple.ionodecache",
            "com.apple.nsurlsessiond_privileged",
            "com.apple.thermalmonitord",
            "com.apple.fairplaydeviceidentityd",
            "com.apple.appleh16camerad",
            "com.apple.gssd",
            "com.apple.awdd",
            "com.apple.contextstored",
            "com.apple.systemstats.daily",
            "com.apple.ManagedClient.enroll",
            "com.apple.recoveryos-lockout-service",
            "com.apple.msrpc.mdssvc",
            "com.apple.idleassetsd",
            "com.apple.remotemanagementd",
            "com.apple.NetworkSharing",
            "com.apple.afpfs_checkafp",
            "com.apple.startupdiskhelper",
            "com.apple.CryptoTokenKit.ahp",
            "com.apple.systemstats.microstackshot_periodic",
            "com.apple.SCHelper",
            "com.apple.findmy.findmybeaconingd",
            "com.apple.mDNSResponderHelper.reloaded",
            "com.apple.softwareupdate_firstrun_tasks",
            "com.apple.timezoneupdates.tzd",
            "com.apple.ifdreader",
            "com.apple.opendirectoryd",
            "com.apple.AssetCache.builtin",
            "com.apple.corestorage.corestoragehelperd",
            "com.apple.AppSSOAgent.login",
            "com.apple.aonsensed",
            "com.apple.countryd",
            "com.apple.appstored",
            "com.apple.powerdatad",
            "com.apple.preferences.timezone.admintool",
            "com.apple.DataDetectorsSourceAccess",
            "com.apple.devicemanagementclient.teslad",
            "com.apple.statd.notify",
            "com.apple.apsd",
            "com.apple.findmymacmessenger",
            "com.apple.internal.aupbregistrarservice",
            "com.apple.appinstalld",
            "com.apple.ReportCrash.Root",
            "com.apple.noticeboard.state",
            "com.apple.lsd",
            "com.apple.threadradiod",
            "com.apple.afpfs_afpLoad",
            "com.apple.metadata.mds.index",
            "com.apple.coreservices.launchservicesd",
            "com.apple.trustd",
            "com.apple.timed",
            "com.apple.multiversed",
            "com.apple.siri.acousticsignature",
            "com.apple.usbmuxd",
            "com.apple.dt.RemotePairingDataVaultHelper",
            "com.apple.securityd",
            "com.apple.cmio.IIDCVideoAssistant",
            "com.apple.ManagedClient.cloudconfigurationd",
            "com.apple.appleh13camerad",
            "com.apple.dynamic_pager",
            "com.apple.attentionawarenessd",
            "com.apple.locationd",
            "com.apple.nesessionmanager",
            "com.apple.online-auth-agent.xpc",
            "com.apple.usbsmartcardreaderd",
            "com.apple.bcmwlan-0x100000ae0",
            "com.apple.security.syspolicy",
            "com.apple.GameController.gamecontrollerd",
            "com.apple.CrashReporterSupportHelper",
            "com.apple.ioupsd",
            "com.apple.rtcreportingd",
            "com.apple.nearbyd",
            "com.apple.wallpaper.export",
            "com.apple.cfnetwork.cfnetworkagent",
            "com.apple.ocspd",
            "com.apple.symptomsd",
            "com.apple.MobileSoftwareUpdate.CleanupPreparePathService",
            "com.apple.AppStoreDaemon.StorePrivilegedTaskService",
            "com.apple.deviceinterfaced",
            "com.apple.biometrickitd",
            "com.apple.autofsd",
            "com.apple.cloudd",
            "com.apple.DumpGPURestart",
            "com.apple.usbctelemetryd",
            "com.apple.secinitd",
            "com.apple.fskit.fskit_helper",
            "com.apple.powerlogHelperd",
            "com.apple.powerexperienced",
            "com.apple.apfsd",
            "com.apple.csrutil.report",
            "com.apple.security.agent.login.00000000-0000-0000-0000-0000000186B1",
            "com.apple.MobileAsset.ManifestStorageService",
            "com.apple.iokit.ioserviceauthorized",
            "com.apple.backgroundtaskmanagementd",
            "com.apple.UserEventAgent-System",
            "com.apple.dasd",
            "com.apple.kuncd",
            "com.apple.Kerberos.kcm",
            "com.apple.corecaptured",
            "com.apple.usbd",
            "com.apple.sessionlogoutd",
            "com.apple.Kerberos.kdc",
            "com.apple.triald.system",
            "com.apple.aned",
            "com.apple.coreservices.sharedfilelistd",
            "com.apple.wifip2pd",
            "com.apple.scsid",
            "com.apple.AssetCacheManagerService",
            "com.apple.logd_reporter",
            "com.apple.Kerberos.kadmind",
            "com.apple.timesync.audioclocksyncd",
            "com.apple.IOAccelMemoryInfoCollector",
            "com.apple.griddatad",
            "com.apple.distnoted.xpc.daemon",
            "com.apple.AppleCredentialManagerDaemon",
            "com.apple.systemstatusd",
            "com.apple.dt.fetchsymbolsd",
            "com.apple.mDNSResponder.reloaded",
            "com.apple.PerfPowerServices",
            "com.apple.alf",
            "com.apple.handwritingd",
            "com.apple.bridgeOSUpdateProxy",
            "com.apple.BluetoothUIService",
            "com.apple.coresymbolicationd",
            "com.apple.bsd.dirhelper",
            "com.apple.cmio.AVCAssistant",
            "com.apple.IOUserBluetoothSerialDriver-0x100000db3",
            "adda",
            "com.apple.msrpc.srvsvc",
            "com.apple.msrpc.lsarpc",
            "com.apple.diskimagesiod.spb",
            "com.apple.dspluginhelperd",
            "com.apple.efilogin-helper",
            "com.apple.loginwindow",
            "com.apple.nand_task_scheduler",
            "com.apple.logind",
            "com.apple.filesystems.userfs_helper",
            "com.apple.ReportMemoryException",
            "com.apple.PerfPowerServicesExtended",
            "com.apple.tracd",
            "com.apple.revisiond",
            "com.apple.suhelperd",
            "com.apple.KernelEventAgent",
            "com.apple.sysextd",
            "com.apple.cmio.iOSScreenCaptureAssistant",
            "com.apple.RFBEventHelper",
            "com.apple.aslmanager",
            "com.apple.security.authhost.00000000-0000-0000-0000-0000000186B1",
            "com.apple.mobile.usermanagerd",
            "com.apple.smb.preferences",
            "com.apple.rapportd",
            "com.apple.analyticsd",
            "com.apple.osanalytics.osanalyticshelper",
            "com.apple.findmymacd",
            "com.apple.bluetoothd",
            "com.apple.racoon",
            "com.apple.mobile.storage_mounter",
            "com.apple.msrpc.netlogon",
            "com.apple.taskgated-helper",
            "com.apple.cfprefsd.xpc.daemon",
            "com.apple.bosreporter",
            "com.apple.notifyd",
            "com.apple.MobileSoftwareUpdate.CryptegraftService",
            "org.wireshark.ChmodBPF",
            "com.apple.CodeSigningHelper",
            "com.apple.xartstorageremoted",
            "com.apple.hidd",
            "com.apple.sandboxd",
            "com.apple.sysmond",
            "com.apple.corebrightnessd",
            "com.apple.unmountassistant.sysagent",
            "com.apple.metadata.mds.scan",
            "com.apple.RemotePairTool",
            "com.apple.tailspind",
            "com.apple.AirPlayXPCHelper",
            "com.apple.mobile.notification_proxy",
            "com.apple.cmio.registerassistantservice",
            "com.apple.familycontrols",
            "com.apple.relatived",
        ]
    );
    Ok(())
}
